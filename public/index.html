<html>
<head>
	<title>minimal demo</title>
	<meta charset="iso-8859-1" />
	<script src="convnet-min.js"></script>
	<script type="text/javascript">
		var in_database = "matrix_2";
		var result;
		var rows = 25, cols = 6;
		var N = 8;
		var net;
		function start() {
			var layers_def = [];

			layers_def.push({type:"input", out_sx: N, out_sy: N, out_depth: N});
			//layers_def.push({type:"conv", sx:5, filters:8, stride:1, pad:2, avtivation:"relu"});
			//layers_def.push({type:"pool", sx:2, stride:2});
			//layers_def.push({type:"conv", sx:5, filters:16, stride:1, pad:2, avtivation:"relu"});
			//layers_def.push({type:"pool", sx:3, stride:3});
			layers_def.push({type:'fc', num_neurons:20, activation:'relu'}); 
			layers_def.push({type:"softmax", num_classes:2});

			net = new convnetjs.Net();
			net.makeLayers(layers_def);

			var trainer = new convnetjs.Trainer(net, {learning_rate:0.00001, l2_decay:0.0001});
			var x1 = new convnetjs.Vol(result.gestures[1][result.gestures[1].length - 1].matrix);
			var x2 = new convnetjs.Vol(result.gestures[1][1].matrix);
			var y = new convnetjs.Vol(result.gestures[2][result.gestures[2].length - 1].matrix);
			var prob_vol;

			/*
			trainer.train(x1, 0);
			trainer.train(x2, 0);
			trainer.train(y, 1);			
			*/

			var ntrain = Math.floor(result.gestures[1].length / 10 * 9);
			for (var i = 1; i < result.gestures.length; i++) {
				for (var j = 0; j < ntrain; j++) {
					var x = new convnetjs.Vol(result.gestures[i][j].matrix);
					trainer.train(x, i - 1);
				}
			}

			var res = new Array();
			for (var i = 1; i < result.gestures.length; i++) {
				res[i] = 0;
				for (var j = ntrain; j < result.gestures[i].length; j++) {
					var x = new convnetjs.Vol(result.gestures[i][j].matrix);
					prob_vol = net.forward(x);
					if (prob_vol.w[i-1] > 0.5) res[i]++;
				}
			}

			console.log(res);
			for (var i = 1; i < result.gestures.length; i++) {
				console.log((i - 1) + ": " + res[i] / (result.gestures[i].length / 10));
			}

			/*
			prob_vol = net.forward(x1);
			console.log(prob_vol);
			prob_vol = net.forward(y);
			console.log(prob_vol);
			*/
		}
		
		var load = function () {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					result = JSON.parse(this.responseText);
					start();
				}
			};
			xhttp.open("GET", in_database + ".json", true);
			xhttp.send();
		};
		
		/*
		var load = function () {
			result = localStorage.getItem("matrix_2");
			result = JSON.parse(result);
			start();
		}
		*/
	</script>
</head>

<body onload="load()">
	<div id="egdiv"></div>
</body>
</html>
